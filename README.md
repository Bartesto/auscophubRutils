# auscophubRutils
[![Travis-CI Build Status](https://travis-ci.org/Bartesto/auscophubRutils.svg?branch=master)](https://travis-ci.org/Bartesto/auscophubRutils) [![AppVeyor Build Status](https://ci.appveyor.com/api/projects/status/github/Bartesto/auscophubRutils?branch=master&svg=true)](https://ci.appveyor.com/project/Bartesto/auscophubRutils)

The functions in this package have been designed to be part of a workflow incorporating data from the Australian Regional Copernicus Hub and follow on from using some of their python scripts which identify suitable Sentinel-2 data tiles for download.

In short these functions:

1. Download zipped data from a text file list
1. Create a local archive for storing Sentinel-2 data
1. Extract the jp2 band data from the zip files and copies them to the archive
1. Moves the original zip file and stores it appropriately in the archive

## Installation

You can install auscophubRutils from github with:

```R
# install.packages("devtools")
devtools::install_github("auscophubRutils/Bartesto", build_vignettes = TRUE)
```


## Suggested Workflow

### 1. Download
The starting point for using these functions is a text file of URL paths for selected downloads as generated by using the python script **auscophub_searchServer.py**. It is outside the scope of this vignette to explain its usage however there is an internal document outlining its use.

The text file by default is named **aoi_download_list.txt** and the location of this list will be your working directory. 

To get started use the *sent_down* function and provide the working directory (**wdir**). Use the following, changing the file path to suit your working directory:
```R
sent_down(wdir = "Z:/blah/working")
```

The function has default values for where you want the downloads to go (**ddir**) and for the name of the text file of download URLS (**file**). If you have good reason to change these you can, in which case use the following:
```R
sent_down(wdir = "Z:/blah/working", ddir = "Y:/sentinel/zdownloads", file = "aoi_download_list.txt")
```
The default locations for **ddir** and **file** are shown above but you can change them to suit your needs.

The *sent_down* function will iteratively download the Sentinel-2 data described in the **aoi_download_list.txt** and by default store them in the RS Section's local archive as indicated above. Depending on internet speeds it can take approximately 15 minutes per download (each download is about 750MB)

### 2. Store
The default location for the downloads is "Y:/sentinel/zdownloads". This will be the staging area for fresh downloads before they are then archived according to tile ID and date. The data commonly used by the RS Section (individual satellite sensor bands) is nested deeply within a folder structure inside the zipped download. 

The *sent_sort*  function creates some folders within the local archive (tile and date), extracts only the band data and moves this and the original zipped file to the appropriate location. To use:
```R
sent_sort()
```
Simple huh? There are two default values. The top directory (**topdir**) and download directory (**ddir**) are given to suit the RS Section's archive however they can be changed if needed.
```R
sent_sort(topdir = "Y:/sentinel", ddir = "Y:/sentinel/zdownloads")
```
This process is relatively quick (20 seconds per download). At the completion of each "sort" it will print a message to screen.
